{% extends 'base.html' %}

{% block content %}
  <h2>Trades</h2>
  
  <div class="card" style="margin-bottom:24px; padding:16px;">
    <form method="post" action="{{ url_for('create_trade') }}" style="display:flex; flex-wrap:wrap; gap:24px; align-items:flex-end;">
        <div style="flex:0 1 120px;">
          <label class="subtle">Symbol</label>
          <input type="text" name="symbol" required placeholder="AAPL" style="width:100%; margin-top:6px;">
        </div>
        <div style="flex:0 1 140px;">
          <label class="subtle">Position Size</label>
          <input type="number" name="position_size" required step="0.0001" style="width:100%; margin-top:6px;">
        </div>
        <div style="flex:0 1 140px;">
          <label class="subtle">Entry Price</label>
          <input type="number" name="entry_price" required step="0.0001" style="width:100%; margin-top:6px;">
        </div>
        <div style="flex:0 1 140px;">
          <label class="subtle">Exit Price</label>
          <input type="number" name="exit_price" required step="0.0001" style="width:100%; margin-top:6px;">
        </div>
        <div style="flex:0 1 160px;">
          <label class="subtle">Date</label>
          <input type="date" name="trade_date" required style="width:100%; margin-top:6px;">
        </div>
        <div style="flex:0 0 auto;">
          <button type="submit">Add Trade</button>
        </div>
    </form>
  </div>

  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
    <div class="subtle">Showing page {{ page }} of {{ total_pages }} ({{ total }} total)</div>
    <div>
      <form method="get" style="display:inline-block;">
        <label class="subtle">Per page:</label>
        <input type="number" name="per_page" value="{{ per_page }}" min="1" style="width:72px;">
        <input type="hidden" name="page" value="1">
        <button type="submit">Set</button>
      </form>
    </div>
  </div>
  {% if trades %}
    <table style="width:100%; border-collapse: collapse;">
      <thead>
        <tr>
          <th style="text-align:left; padding:8px; border-bottom:1px solid #1f2a38">Date</th>
          <th style="text-align:left; padding:8px; border-bottom:1px solid #1f2a38">Symbol</th>
          <th style="text-align:right; padding:8px; border-bottom:1px solid #1f2a38">Size</th>
          <th style="text-align:right; padding:8px; border-bottom:1px solid #1f2a38">Entry</th>
          <th style="text-align:right; padding:8px; border-bottom:1px solid #1f2a38">Exit</th>
          <th style="text-align:right; padding:8px; border-bottom:1px solid #1f2a38">Profit</th>
          <th style="text-align:center; padding:8px; border-bottom:1px solid #1f2a38">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for t in trades %}
          <tr class="card" style="background:transparent; border:0;">
            <td style="padding:8px"><a href="{{ url_for('trade_detail', trade_id=t.id) }}">{{ t.trade_date }}</a></td>
            <td style="padding:8px">{{ t.symbol }}</td>
            <td style="padding:8px; text-align:right">{{ '%.2f'|format(t.position_size) }}</td>
            <td style="padding:8px; text-align:right">{{ '%.2f$'|format(t.entry_price) }}</td>
            <td style="padding:8px; text-align:right">{{ '%.2f$'|format(t.exit_price) }}</td>
            <td style="padding:8px; text-align:right" class="pl {% if t.profit >= 0 %}positive{% else %}negative{% endif %}">{{ '%.2f$'|format(t.profit) }}</td>
            <td style="padding:8px; text-align:center">
              <form method="post" action="{{ url_for('delete_trade', trade_id=t.id) }}" style="display:inline;">
                <button type="submit" onclick="return confirm('Delete trade {{ t.id }} ({{ t.symbol }})?')" style="background:#e74c3c; color:white; border:0; padding:6px 10px; border-radius:4px; cursor:pointer;">Delete</button>
              </form>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
    <div style="display:flex; justify-content:space-between; align-items:center; margin-top:12px;">
      <div>
        {% if page > 1 %}
          <a href="?page={{ page-1 }}&per_page={{ per_page }}">&larr; Prev</a>
        {% endif %}
      </div>
      <div class="subtle">Page {{ page }} / {{ total_pages }}</div>
      <div>
        {% if page < total_pages %}
          <a href="?page={{ page+1 }}&per_page={{ per_page }}">Next &rarr;</a>
        {% endif %}
      </div>
    </div>
  {% else %}
    <p class="subtle">No trades found.</p>
  {% endif %}

  <script>
    // Set today's date as default for the trade date picker
    document.addEventListener('DOMContentLoaded', function() {
      const today = new Date();
      const year = today.getFullYear();
      const month = String(today.getMonth() + 1).padStart(2, '0');
      const day = String(today.getDate()).padStart(2, '0');
      document.querySelector('input[name="trade_date"]').value = `${year}-${month}-${day}`;
    });
  </script>
{% endblock %}
